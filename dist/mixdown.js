!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var o,i,r=function(){function t(t){this.generation=[],this.data=[],this.freeList=[];for(var e=0;e<t;++e)this.generation[e]=0,this.data[e]=null,this.freeList.push(e)}return t.prototype.add=function(t){if(0!==this.freeList.length){var e=this.freeList.pop();return this.data[e]=t,{index:e,generation:this.generation[e]}}},t.prototype.get=function(t){if(t.generation===this.generation[t.index]){var e=t.index;if(null!==this.data[e])return this.data[e]}},t.prototype.findFirst=function(t){for(var e=0;e<this.data.length;++e){var n=this.data[e];if(null!==n&&t(n))return n}},t.prototype.remove=function(t){if(t.generation===this.generation[t.index]){var e=t.index;this.generation[e]+=1,this.data[e]=null,this.freeList.push(e)}},t.prototype.valid=function(t){return t.generation===this.generation[t.index]},t.prototype.numFreeSlots=function(){return this.freeList.length},t.prototype.numUsedSlots=function(){return this.data.length-this.freeList.length},t}();n.d(e,"Mixdown",(function(){return s})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(o||(o={})),function(t){t[t.SUCCESS=0]="SUCCESS",t[t.DOES_NOT_EXIST=1]="DOES_NOT_EXIST"}(i||(i={}));var s=function(){function t(t,e,n){void 0===t&&(t=32),void 0===e&&(e=2),void 0===n&&(n=4),this.context=new AudioContext,this.assetMap={},this.removalFadeDuration=.2,this.maxSounds=t,this.slopSize=n,this.masterGain=this.context.createGain(),this.masterGain.connect(this.context.destination),this.voices=new r(t),this.streams=new r(e)}return t.prototype.suspend=function(){"suspended"!==this.context.state&&this.context.suspend()},t.prototype.resume=function(){"running"!==this.context.state&&this.context.resume()},t.prototype.play=function(t){switch(t.kind){case"sound":return this.playSound(t);case"music":return this.playMusic(t)}},t.prototype.playSound=function(t){var e=this,n=this.assetMap[t.asset];if(n){var o=this.numFreeSlots();if(o<=0)console.warn("mixdown had no free slots to play sound.");else{var i=this.context;o<=this.slopSize&&this.evictVoice(t.priority);var r=i.createBufferSource();r.buffer=n,t.loop&&(r.loop=!0,r.loopStart=t.loop.start,r.loopEnd=t.loop.end);var s=i.createStereoPanner();r.connect(s);var a=i.createGain();s.connect(a),a.gain.setValueAtTime(t.gain,i.currentTime),a.connect(this.masterGain);var u=0,c=n.duration;t.clip&&(c=Math.max(0,t.clip.end-t.clip.start),u=t.clip.start),r.start(0,u,c);var p=this.voices.add({gain:a,balance:s,source:r,priority:t.priority});if(p){var d={kind:"voice",index:p.index,generation:p.generation};return r.onended=function(){e.voiceEnded(d)},d}}}},t.prototype.playMusic=function(t){if(0!==this.streams.numFreeSlots())if(this.numFreeSlots()<=0)console.warn("mixdown had no free slots to play music.");else{var e=new Audio(t.source);e.autoplay=!0,e.loop=!0;var n=this.context,o=n.createMediaElementSource(e),i=n.createStereoPanner();o.connect(i);var r=n.createGain();i.connect(r),r.gain.setValueAtTime(t.gain,n.currentTime),r.connect(this.masterGain);var s=this.streams.add({gain:r,balance:i,source:o,audio:e});if(s)return{kind:"stream",index:s.index,generation:s.generation}}},t.prototype.stop=function(t){return"voice"===t.kind?this.stopSound(t):this.stopMusic(t)},t.prototype.stopSound=function(t){var e=this.voices.get(t);return e&&e.source?(e.source.stop(),i.SUCCESS):i.DOES_NOT_EXIST},t.prototype.stopMusic=function(t){var e=this.streams.get(t);return e&&e.source&&e.gain&&e.balance?(e.source.disconnect(),e.gain.disconnect(),e.balance.disconnect(),e.audio.pause(),this.streams.remove(t),i.SUCCESS):i.DOES_NOT_EXIST},t.prototype.loop=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0);var o=this.voices.get(t);if(!o)return i.DOES_NOT_EXIST;var r=o.source;return r.loop=!0,r.loopStart=e,r.loopEnd=n,i.SUCCESS},t.prototype.stopLoop=function(t){var e=this.voices.get(t);if(!e)return i.DOES_NOT_EXIST;var n=e.source;return n.loop=!1,n.loopStart=0,n.loopEnd=0,i.SUCCESS},t.prototype.fadeTo=function(t,e,n){var o;return(o="voice"===t.kind?this.voices.get(t):this.streams.get(t))?(o.gain.gain.exponentialRampToValueAtTime(e,this.context.currentTime+n),i.SUCCESS):i.DOES_NOT_EXIST},t.prototype.fadeOut=function(t,e){return this.fadeTo(t,.001,e)},t.prototype.gain=function(t,e){var n;return(n="voice"===t.kind?this.voices.get(t):this.streams.get(t))&&n.gain?(n.gain.gain.setValueAtTime(e,this.context.currentTime),i.SUCCESS):i.DOES_NOT_EXIST},t.prototype.balance=function(t,e){var n;return(n="voice"===t.kind?this.voices.get(t):this.streams.get(t))&&n.balance?(n.balance.pan.setValueAtTime(e,this.context.currentTime),i.SUCCESS):i.DOES_NOT_EXIST},t.prototype.loadAsset=function(t,e){var n=this;fetch(e).then((function(t){return t.arrayBuffer()})).then((function(t){return n.context.decodeAudioData(t)})).then((function(e){return n.assetMap[t]=e})).catch((function(t){return console.error(t)}))},t.prototype.numFreeSlots=function(){return this.voices.numFreeSlots()-this.streams.numUsedSlots()},t.prototype.voiceEnded=function(t){var e=this.voices.get(t);e&&e.source&&e.gain&&e.balance&&(e.source.disconnect(),e.source.buffer=null,e.gain.disconnect(),e.balance.disconnect(),this.voices.remove(t))},t.prototype.evictVoice=function(t){var e=this.voices.findFirst((function(e){return e.priority<t}));if(void 0===e||!e.gain||!e.source)return!1;var n=this.context;return e.gain.gain.exponentialRampToValueAtTime(.001,n.currentTime+this.removalFadeDuration),e.source.stop(n.currentTime+this.removalFadeDuration),!0},t}()}]);